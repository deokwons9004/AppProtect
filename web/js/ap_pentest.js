/* This Javascript contains features to identify which test should be performed. */

/**
 * Socket Events
 */
/* Filler Generator Listeners (REJECT NOT USED.) */
socket.on('get_filler_reject', function (error) {
	alert('Error: Failed to get new filler.\nCause:' + err);
});
socket.on('get_filler_success', function (filler) {
//	alert('Got new filler!');
	$('#filler_info').html('<h6>New Filler: ' + 
							filler + 
							'<br>Put this into the inputs of the form you want to POST.' + 
							'<br>Make sure you have your proxy set to ' + ap_url + ' (USE PORT 7999).</h6>');
});

/** 
 * Button Handlers
 */
/* Final Agree Button Handler */
$('#agree_terms_button').click(function () {
	var test_type  = $('#type_selection').val();
	var test_url   = $('#search_text').val();
	var test_db    = $('#db_selection').val();
	var test_level = $('#level_selection').val();
	var test_risk  = $('#risk_selection').val();
	
	/* Test Type wasn't selected. */ 
	if (test_type == null) {
		alert('Please select a valid test from the dropdown.');
	}
	/* ZAP Test Option. */
	else if (test_type == 1) { // ZAP test
		if (test_url == '')
			alert('Please enter a valid URL to test.');
		else {
			socket.emit('test_zap', { url: test_url });
			changeView('test');
		}
	}
	/* SQLMAP Test Option. */
	else if (test_type == 2) {
		if (test_url == '')
			alert('Please enter a valid URL with at least one field to test.');
		else {
			if (test_db    == "Auto" || test_db    == null) test_db    = null;
			if (test_level == "Auto" || test_level == null) test_level = 1;
			if (test_risk  == "Auto" || test_risk  == null) test_risk  = 1;
			
			socket.emit('test_sqlmap', {
				url  : test_url,
				db   : test_db,
				level: test_level,
				risk : test_risk
			});
			changeView('test_sq');
		}
	}
});
/* Cancel Test Button Handler */
$('#cancelButton').click(function () {
//	changeView('panel');
	changePage('panel');
	socket.emit('test_cancel');
});
/* Back To User Panel Button Handler */
$('#backButton').click(function () {
//	changeView('panel');
	changePage('panel');
});