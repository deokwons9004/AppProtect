/* This Javascript contains all the client side features for OWASP ZAP Test. */

/**
 * Socket Events
 */
socket.on('test_zap_reject', function (err) {
	alert('Error: Zap crashed.\nCause:' + err);
	changeView('panel');
});
socket.on('test_zap_success', function (data) {
	changeView('result');
	
	data.forEach(function (item, i) {
		var output = '';
		output += '<h5>' + item.alert + '</h5>';
		output += '<p>Risk Level: ' + item.risklevel + '</p>';
		output += '<p>Risk Description: ' + item.risktext + '</p>';
		output += '<p>Description: ' + jQuery(item.description).text() + '</p>';
		item.instances.forEach(function (url, j) {
			output += '<p>Instance: ' + url + '</p>';
		});
		output += '<p>Instance Count: ' + item.count + '</p>';
		output += '<p>solution: ' + jQuery(item.solution).text() + '</p>';
		output += '<p>Info: ' + jQuery(item.info).text() + '</p>';
		output += '<p>Ref: ' + jQuery(item.ref).text() + '</p>';
		$('#result').append(output);
	});
});

socket.on('progress_zap_0_exec', function () {
	$('#progress').children('p').remove();
	$('#progress').append('<p>Initializing Test...</p>');
});
socket.on('progress_zap_1_spider', function () {
	$('#progress').children().last().remove();
	$('#progress').append('<p>Performing Test Part 1... (THIS MAY TAKE A WHILE)</p>');
});
socket.on('progress_zap_2_active', function () {
	$('#progress').children().last().remove();
	$('#progress').append('<p>Performing Test Part 2...</p>');
});
socket.on('progress_zap_3_attack_done', function () {
	$('#progress').children().last().remove();
	$('#progress').append('<p>Finishing Test...</p>');
});
socket.on('progress_zap_4_write_start', function () {
	$('#progress').children().last().remove();
	$('#progress').append('<p>Writing New Report...</p>');
});
socket.on('progress_zap_5_write_done', function () {
	$('#progress').children().last().remove();
	$('#progress').append('<p>Checking Report Status...</p>');
});
socket.on('progress_zap_6_parse_start', function () {
	$('#progress').children().last().remove();
	$('#progress').append('<p>Getting Report Information...</p>');
});
socket.on('progress_zap_7_parse_done', function () {
	$('#progress').children().last().remove();
	$('#progress').append('<p>Finishing up...</p>');
});
